<?php
$this->htmlElement('body')->appendAttribute('class', 'site-pages add sidebar-open');
$this->ckEditor();
$this->headScript()->appendFile($this->assetUrl('js/sortable.js', 'Omeka'));
$this->headScript()->appendFile($this->assetUrl('js/site-page-edit.js', 'Omeka'));
$this->blockLayout()->prepareForm();
$form->prepare();
$escape = $this->plugin('escapeHtml');
?>
<?php echo $this->pageTitle(sprintf($this->translate('Edit Page: “%s”'), $page->title())); ?>

<?php echo $this->form()->openTag($form); ?>
<div id="page-actions">
    <a href="<?php echo $page->siteUrl(); ?>" class="button"><?php echo $this->translate('View'); ?></a>
    <a href="#" class="sidebar-confirm delete button" data-sidebar-confirm-url="<?php echo $escape($page->url('delete')); ?>"><?php echo $this->translate('Delete'); ?></a>
    <button><?php echo $this->translate('Save'); ?></button>
</div>

<?php echo $this->formCollection($form, false); ?>

<?php echo $this->blockLayout()->forms($page); ?>

<?php echo $this->form()->closeTag(); ?>

<div class="active sidebar">
    <label for="new-block">
        <?php echo $this->translate('Add New Block'); ?>
    </label>
    <select id="new-block" data-url="<?php echo $this->url('admin/site/page/default', array('action' => 'block'), true); ?>">
        <option value=""><?php echo $this->translate('Select layout'); ?></option>
        <?php foreach ($this->blockLayout()->getLayouts() as $layout): ?>
        <option value="<?php echo $escape($layout); ?>">
            <?php echo $escape($this->blockLayout()->getLayoutLabel($layout)); ?>
        </option>
        <?php endforeach; ?>
    </select>
</div>

<div id="attachment-options" class="sidebar" data-url="<?php echo $this->url(null, ['action' => 'attachment-item-options'], true); ?>">
    <a href="#" class="sidebar-close o-icon-close"><span class="screen-reader-text"><?php echo $this->translate('Close Me'); ?></span></a>
    <h2><?php echo $this->translate('Attachment'); ?></h2>
    <div id="attachment-item"></div>
    <div id="attachment-caption" class="option">
        <h3><?php echo $this->translate('Caption'); ?></h3>
        <a href="#" class="collapse" aria-label="<?php echo $this->translate('Collapse'); ?>" title="<?php echo $this->translate('Collapse'); ?>"></a>
        <div class="collapsible">
            <textarea class="caption wysiwyg"></textarea>
        </div>
    </div>
    <div id="attachment-confirm-panel" class="confirm-panel">
        <button><?php echo $this->translate('Apply changes'); ?></button>
    </div>
</div>

<div id="delete" class="sidebar">
    <a href="#"
        class="sidebar-close o-icon-close"
        aria-label="<?php echo $escape($this->translate('Close')); ?>"
        title="<?php echo $escape($this->translate('Close')); ?>"></a>
    <div id="sidebar-confirm">
        <h2><?php echo $this->translate('Delete Item'); ?></h2>
        <p><?php echo $this->translate('Are you sure you would like to delete this page?'); ?></p>
        <?php echo $this->form($confirmForm); ?>
    </div>
</div>

<?php echo $this->partial('common/resource-select-sidebar'); ?>
